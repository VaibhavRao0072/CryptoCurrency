import { Component, OnInit } from '@angular/core';
import { HTTP } from '@ionic-native/http/ngx';
import { NavigationExtras, Router } from '@angular/router';
import { IonLoaderService } from '../services/ion-loader.service';
import { Post } from '../intefrace/post.model';
import { Platform} from '@ionic/angular';

@Component({
  selector: 'app-home',
  templateUrl: 'home.page.html',
  styleUrls: ['home.page.scss'],
})
export class HomePage implements OnInit{
  
  responseData ={};
  showTryAgain : boolean = false;
  cryptoListUrl : string = "https://pro-api.coinmarketcap.com/v1/cryptocurrency/listings/latest?&limit=20";
  headers = {
    'X-CMC_PRO_API_KEY': 'cdcfd4be-f0d1-4fcc-a0ce-484887b9117e',
    'Access-Control-Allow-Origin': '*',
  }
  constructor(public http: HTTP,public router: Router,private ionLoaderService: IonLoaderService,private platform: Platform) {
  }

  ngOnInit(){
    //this.getListOfCrypto();
     let response : Post= {"status":{"timestamp":"2021-08-03T13:33:28.103Z","error_code":0,"error_message":null,"elapsed":15,"credit_count":1,"notice":null,"total_count":5912},"data":[{"id":1,"name":"Bitcoin","symbol":"BTC","slug":"bitcoin","num_market_pairs":8937,"date_added":"2013-04-28T00:00:00.000Z","tags":["mineable","pow","sha-256","store-of-value","state-channels","coinbase-ventures-portfolio","three-arrows-capital-portfolio","polychain-capital-portfolio","binance-labs-portfolio","arrington-xrp-capital","blockchain-capital-portfolio","boostvc-portfolio","cms-holdings-portfolio","dcg-portfolio","dragonfly-capital-portfolio","electric-capital-portfolio","fabric-ventures-portfolio","framework-ventures","galaxy-digital-portfolio","huobi-capital","alameda-research-portfolio","a16z-portfolio","1confirmation-portfolio","winklevoss-capital","usv-portfolio","placeholder-ventures-portfolio","pantera-capital-portfolio","multicoin-capital-portfolio","paradigm-xzy-screener"],"max_supply":21000000,"circulating_supply":18775056,"total_supply":18775056,"platform":null,"cmc_rank":1,"last_updated":"2021-08-03T13:33:05.000Z","quote":{"USD":{"price":38447.289642947355,"volume_24h":25607606559.929543,"percent_change_1h":0.77752064,"percent_change_24h":-2.41085696,"percent_change_7d":-0.0245432,"percent_change_30d":8.69070503,"percent_change_60d":4.38626205,"percent_change_90d":-31.15062002,"market_cap":721850016094.5566,"last_updated":"2021-08-03T13:33:05.000Z"}}},{"id":1027,"name":"Ethereum","symbol":"ETH","slug":"ethereum","num_market_pairs":5638,"date_added":"2015-08-07T00:00:00.000Z","tags":["mineable","pow","smart-contracts","ethereum","coinbase-ventures-portfolio","three-arrows-capital-portfolio","polychain-capital-portfolio","binance-labs-portfolio","arrington-xrp-capital","blockchain-capital-portfolio","boostvc-portfolio","cms-holdings-portfolio","dcg-portfolio","dragonfly-capital-portfolio","electric-capital-portfolio","fabric-ventures-portfolio","framework-ventures","hashkey-capital-portfolio","kinetic-capital","huobi-capital","alameda-research-portfolio","a16z-portfolio","1confirmation-portfolio","winklevoss-capital","usv-portfolio","placeholder-ventures-portfolio","pantera-capital-portfolio","multicoin-capital-portfolio","paradigm-xzy-screener"],"max_supply":null,"circulating_supply":116953803.999,"total_supply":116953803.999,"platform":null,"cmc_rank":2,"last_updated":"2021-08-03T13:32:26.000Z","quote":{"USD":{"price":2514.5239496327713,"volume_24h":23885571571.037956,"percent_change_1h":1.25739655,"percent_change_24h":-3.04055992,"percent_change_7d":9.04922055,"percent_change_30d":8.64712589,"percent_change_60d":-5.27130948,"percent_change_90d":-25.19925491,"market_cap":294083141156.14246,"last_updated":"2021-08-03T13:32:26.000Z"}}},{"id":825,"name":"Tether","symbol":"USDT","slug":"tether","num_market_pairs":16219,"date_added":"2015-02-25T00:00:00.000Z","tags":["payments","stablecoin","stablecoin-asset-backed","avalanche-ecosystem","solana-ecosystem"],"max_supply":null,"circulating_supply":61990121093.688835,"total_supply":64469737785.68351,"platform":{"id":1027,"name":"Ethereum","symbol":"ETH","slug":"ethereum","token_address":"0xdac17f958d2ee523a2206206994597c13d831ec7"},"cmc_rank":3,"last_updated":"2021-08-03T13:33:00.000Z","quote":{"USD":{"price":1.00022575322296,"volume_24h":52776180029.915306,"percent_change_1h":-0.03462545,"percent_change_24h":-0.02410749,"percent_change_7d":-0.0042409,"percent_change_30d":0.07495951,"percent_change_60d":-0.08425578,"percent_change_90d":0.03530084,"market_cap":62004115563.31741,"last_updated":"2021-08-03T13:33:00.000Z"}}},{"id":1839,"name":"Binance Coin","symbol":"BNB","slug":"binance-coin","num_market_pairs":542,"date_added":"2017-07-25T00:00:00.000Z","tags":["marketplace","centralized-exchange","payments","binance-smart-chain","alameda-research-portfolio","multicoin-capital-portfolio"],"max_supply":168137036,"circulating_supply":168137036,"total_supply":168137036,"platform":null,"cmc_rank":4,"last_updated":"2021-08-03T13:32:31.000Z","quote":{"USD":{"price":323.41919469942724,"volume_24h":1365434818.9580874,"percent_change_1h":1.18272037,"percent_change_24h":-2.3403225,"percent_change_7d":2.306864,"percent_change_30d":6.54661501,"percent_change_60d":-16.62348159,"percent_change_90d":-50.27785963,"market_cap":54378744782.26861,"last_updated":"2021-08-03T13:32:31.000Z"}}},{"id":2010,"name":"Cardano","symbol":"ADA","slug":"cardano","num_market_pairs":283,"date_added":"2017-10-01T00:00:00.000Z","tags":["mineable","dpos","pos","platform","research","smart-contracts","staking","binance-smart-chain"],"max_supply":45000000000,"circulating_supply":32081210042.358,"total_supply":32936637337.181,"platform":null,"cmc_rank":5,"last_updated":"2021-08-03T13:32:38.000Z","quote":{"USD":{"price":1.32633276970244,"volume_24h":1436538708.9676778,"percent_change_1h":2.28121099,"percent_change_24h":0.58380666,"percent_change_7d":1.4351534,"percent_change_30d":-7.38014929,"percent_change_60d":-21.59524659,"percent_change_90d":-3.68549855,"market_cap":42550360170.88642,"last_updated":"2021-08-03T13:32:38.000Z"}}},{"id":52,"name":"XRP","symbol":"XRP","slug":"xrp","num_market_pairs":629,"date_added":"2013-08-04T00:00:00.000Z","tags":["medium-of-exchange","enterprise-solutions","binance-chain","arrington-xrp-capital","galaxy-digital-portfolio","a16z-portfolio","pantera-capital-portfolio"],"max_supply":100000000000,"circulating_supply":46312443360,"total_supply":99990333192,"platform":null,"cmc_rank":6,"last_updated":"2021-08-03T13:33:06.000Z","quote":{"USD":{"price":0.71874176669154,"volume_24h":2456730520.4641185,"percent_change_1h":0.89369635,"percent_change_24h":-3.80940873,"percent_change_7d":10.481354,"percent_change_30d":3.94784959,"percent_change_60d":-24.58626288,"percent_change_90d":-54.49057471,"market_cap":33286687360.368282,"last_updated":"2021-08-03T13:33:06.000Z"}}},{"id":3408,"name":"USD Coin","symbol":"USDC","slug":"usd-coin","num_market_pairs":1402,"date_added":"2018-10-08T00:00:00.000Z","tags":["medium-of-exchange","stablecoin","stablecoin-asset-backed"],"max_supply":null,"circulating_supply":27416777062.518597,"total_supply":27416777062.518597,"platform":{"id":1027,"name":"Ethereum","symbol":"ETH","slug":"ethereum","token_address":"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48"},"cmc_rank":7,"last_updated":"2021-08-03T13:32:26.000Z","quote":{"USD":{"price":1.00032048919632,"volume_24h":2627044391.7424135,"percent_change_1h":-0.02421548,"percent_change_24h":-0.0047036,"percent_change_7d":0.0239414,"percent_change_30d":0.10192988,"percent_change_60d":-0.01749356,"percent_change_90d":0.01724976,"market_cap":27425563843.365047,"last_updated":"2021-08-03T13:32:26.000Z"}}},{"id":74,"name":"Dogecoin","symbol":"DOGE","slug":"dogecoin","num_market_pairs":378,"date_added":"2013-12-15T00:00:00.000Z","tags":["mineable","pow","scrypt","medium-of-exchange","memes","payments","doggone-doggerel"],"max_supply":null,"circulating_supply":130707751241.8341,"total_supply":130707751241.8341,"platform":null,"cmc_rank":8,"last_updated":"2021-08-03T13:32:40.000Z","quote":{"USD":{"price":0.19870118336317,"volume_24h":1098690712.8437912,"percent_change_1h":1.12344169,"percent_change_24h":-2.83359503,"percent_change_7d":-4.70609085,"percent_change_30d":-19.80165021,"percent_change_60d":-45.59837408,"percent_change_90d":-70.00668285,"market_cap":25971784846.49129,"last_updated":"2021-08-03T13:32:40.000Z"}}},{"id":6636,"name":"Polkadot","symbol":"DOT","slug":"polkadot-new","num_market_pairs":232,"date_added":"2020-08-19T00:00:00.000Z","tags":["substrate","polkadot","binance-chain","polkadot-ecosystem","three-arrows-capital-portfolio","polychain-capital-portfolio","blockchain-capital-portfolio","boostvc-portfolio","cms-holdings-portfolio","coinfund-portfolio","fabric-ventures-portfolio","fenbushi-capital-portfolio","hashkey-capital-portfolio","kinetic-capital","1confirmation-portfolio","placeholder-ventures-portfolio","pantera-capital-portfolio","exnetwork-capital-portfolio"],"max_supply":null,"circulating_supply":980646582.1355742,"total_supply":1096370738.560762,"platform":null,"cmc_rank":9,"last_updated":"2021-08-03T13:32:30.000Z","quote":{"USD":{"price":17.48223254108852,"volume_24h":1433876887.0979986,"percent_change_1h":2.02100562,"percent_change_24h":-3.40815009,"percent_change_7d":21.70520963,"percent_change_30d":11.12622733,"percent_change_60d":-29.06937608,"percent_change_90d":-54.98159326,"market_cap":17143891589.517773,"last_updated":"2021-08-03T13:32:30.000Z"}}},{"id":7083,"name":"Uniswap","symbol":"UNI","slug":"uniswap","num_market_pairs":292,"date_added":"2020-09-17T00:00:00.000Z","tags":["decentralized-exchange","defi","dao","yield-farming","amm","coinbase-ventures-portfolio","three-arrows-capital-portfolio","governance","blockchain-capital-portfolio","defiance-capital","alameda-research-portfolio","a16z-portfolio","pantera-capital-portfolio","parafi-capital","paradigm-xzy-screener"],"max_supply":1000000000,"circulating_supply":587380045.4856094,"total_supply":1000000000,"platform":{"id":1027,"name":"Ethereum","symbol":"ETH","slug":"ethereum","token_address":"0x1f9840a85d5af5bf1d1762f925bdaddc4201f984"},"cmc_rank":10,"last_updated":"2021-08-03T13:32:17.000Z","quote":{"USD":{"price":21.44478211922872,"volume_24h":498591819.54262894,"percent_change_1h":1.78682192,"percent_change_24h":-3.32432378,"percent_change_7d":12.12340371,"percent_change_30d":4.1553028,"percent_change_60d":-18.01491387,"percent_change_90d":-50.41369409,"market_cap":12596237096.621548,"last_updated":"2021-08-03T13:32:17.000Z"}}},{"id":4687,"name":"Binance USD","symbol":"BUSD","slug":"binance-usd","num_market_pairs":942,"date_added":"2019-09-20T00:00:00.000Z","tags":["stablecoin","stablecoin-asset-backed","binance-chain","binance-smart-chain"],"max_supply":null,"circulating_supply":12079328866.4,"total_supply":12079328866.4,"platform":{"id":1839,"name":"Binance Chain","symbol":"BNB","slug":"binance-coin","token_address":"BUSD-BD1"},"cmc_rank":11,"last_updated":"2021-08-03T13:32:53.000Z","quote":{"USD":{"price":1.00024620712458,"volume_24h":3955923330.6367226,"percent_change_1h":-0.02292601,"percent_change_24h":-0.02292667,"percent_change_7d":0.02629554,"percent_change_30d":0.09963092,"percent_change_60d":-0.038761,"percent_change_90d":0.00482046,"market_cap":12082302883.22705,"last_updated":"2021-08-03T13:32:53.000Z"}}},{"id":1975,"name":"Chainlink","symbol":"LINK","slug":"chainlink","num_market_pairs":537,"date_added":"2017-09-20T00:00:00.000Z","tags":["platform","defi","oracles","smart-contracts","substrate","polkadot","polkadot-ecosystem","avalanche-ecosystem","solana-ecosystem","framework-ventures","polygon-ecosystem"],"max_supply":1000000000,"circulating_supply":443009553.9174637,"total_supply":1000000000,"platform":{"id":1027,"name":"Ethereum","symbol":"ETH","slug":"ethereum","token_address":"0x514910771af9ca656af840dff83e8264ecf986ca"},"cmc_rank":12,"last_updated":"2021-08-03T13:32:18.000Z","quote":{"USD":{"price":23.29859949584419,"volume_24h":1410672986.6100228,"percent_change_1h":3.4470256,"percent_change_24h":3.26166768,"percent_change_7d":20.31091216,"percent_change_30d":23.32948709,"percent_change_60d":-19.08754776,"percent_change_90d":-51.85543914,"market_cap":10321502169.55558,"last_updated":"2021-08-03T13:32:18.000Z"}}},{"id":1831,"name":"Bitcoin Cash","symbol":"BCH","slug":"bitcoin-cash","num_market_pairs":559,"date_added":"2017-07-23T00:00:00.000Z","tags":["mineable","pow","sha-256","marketplace","medium-of-exchange","store-of-value","enterprise-solutions","payments","binance-chain"],"max_supply":21000000,"circulating_supply":18807331.25,"total_supply":18807331.25,"platform":null,"cmc_rank":13,"last_updated":"2021-08-03T13:32:57.000Z","quote":{"USD":{"price":535.9588284663687,"volume_24h":2003291812.333468,"percent_change_1h":1.36671215,"percent_change_24h":-4.07923567,"percent_change_7d":8.26518781,"percent_change_30d":-0.09964997,"percent_change_60d":-19.78820515,"percent_change_90d":-55.65966626,"market_cap":10079955223.328926,"last_updated":"2021-08-03T13:32:57.000Z"}}},{"id":5426,"name":"Solana","symbol":"SOL","slug":"solana","num_market_pairs":105,"date_added":"2020-04-10T00:00:00.000Z","tags":["dpos","platform","solana-ecosystem","cms-holdings-portfolio","kinetic-capital","alameda-research-portfolio","multicoin-capital-portfolio"],"max_supply":null,"circulating_supply":272637427.57725775,"total_supply":494519161.74206734,"platform":null,"cmc_rank":14,"last_updated":"2021-08-03T13:33:06.000Z","quote":{"USD":{"price":35.10308695814046,"volume_24h":471847747.7485654,"percent_change_1h":1.66952087,"percent_change_24h":3.65514344,"percent_change_7d":22.06752499,"percent_change_30d":1.03198859,"percent_change_60d":-4.47428438,"percent_change_90d":-21.40644509,"market_cap":9570415328.2882,"last_updated":"2021-08-03T13:33:06.000Z"}}},{"id":2,"name":"Litecoin","symbol":"LTC","slug":"litecoin","num_market_pairs":709,"date_added":"2013-04-28T00:00:00.000Z","tags":["mineable","pow","scrypt","medium-of-exchange","binance-chain"],"max_supply":84000000,"circulating_supply":66752614.51538747,"total_supply":66752614.51538747,"platform":null,"cmc_rank":15,"last_updated":"2021-08-03T13:33:04.000Z","quote":{"USD":{"price":139.19369553103058,"volume_24h":1359608209.1237812,"percent_change_1h":1.21390525,"percent_change_24h":-2.94406811,"percent_change_7d":4.17616218,"percent_change_30d":-4.57397195,"percent_change_60d":-21.08344258,"percent_change_90d":-59.89775695,"market_cap":9291543100.755096,"last_updated":"2021-08-03T13:33:04.000Z"}}},{"id":3717,"name":"Wrapped Bitcoin","symbol":"WBTC","slug":"wrapped-bitcoin","num_market_pairs":257,"date_added":"2019-01-30T00:00:00.000Z","tags":["medium-of-exchange","defi","wrapped-tokens"],"max_supply":null,"circulating_supply":192574.22484399,"total_supply":192574.22484399,"platform":{"id":1027,"name":"Ethereum","symbol":"ETH","slug":"ethereum","token_address":"0x2260fac5e5542a773aa44fbcfedf7c193bc2c599"},"cmc_rank":16,"last_updated":"2021-08-03T13:32:31.000Z","quote":{"USD":{"price":38449.19265791486,"volume_24h":262153132.63006616,"percent_change_1h":0.67019822,"percent_change_24h":-2.06503446,"percent_change_7d":0.21998638,"percent_change_30d":8.7611085,"percent_change_60d":4.37103408,"percent_change_90d":-31.27469198,"market_cap":7404323471.975185,"last_updated":"2021-08-03T13:32:31.000Z"}}},{"id":3890,"name":"Polygon","symbol":"MATIC","slug":"polygon","num_market_pairs":225,"date_added":"2019-04-28T00:00:00.000Z","tags":["platform","enterprise-solutions","state-channels","coinbase-ventures-portfolio","binance-launchpad","binance-labs-portfolio","polygon-ecosystem"],"max_supply":10000000000,"circulating_supply":6434735794,"total_supply":10000000000,"platform":null,"cmc_rank":17,"last_updated":"2021-08-03T13:32:34.000Z","quote":{"USD":{"price":1.02967294718877,"volume_24h":514286191.88687074,"percent_change_1h":1.54988542,"percent_change_24h":-2.30150381,"percent_change_7d":-1.75223626,"percent_change_30d":-10.04194418,"percent_change_60d":-36.88566973,"percent_change_90d":27.54825307,"market_cap":6625673369.3890505,"last_updated":"2021-08-03T13:32:34.000Z"}}},{"id":1321,"name":"Ethereum Classic","symbol":"ETC","slug":"ethereum-classic","num_market_pairs":273,"date_added":"2016-07-24T00:00:00.000Z","tags":["mineable","pow","ethash","platform","smart-contracts","dcg-portfolio"],"max_supply":210700000,"circulating_supply":128724512.54450244,"total_supply":210700000,"platform":null,"cmc_rank":18,"last_updated":"2021-08-03T13:32:26.000Z","quote":{"USD":{"price":49.59097361662945,"volume_24h":2085972792.5009735,"percent_change_1h":0.94313272,"percent_change_24h":-3.32928643,"percent_change_7d":-0.30844807,"percent_change_30d":-13.55426622,"percent_change_60d":-22.35483567,"percent_change_90d":-33.55283437,"market_cap":6383573905.407907,"last_updated":"2021-08-03T13:32:26.000Z"}}},{"id":512,"name":"Stellar","symbol":"XLM","slug":"stellar","num_market_pairs":350,"date_added":"2014-08-05T00:00:00.000Z","tags":["medium-of-exchange","enterprise-solutions","decentralized-exchange","smart-contracts","hashkey-capital-portfolio"],"max_supply":50001806812,"circulating_supply":23404278665.911133,"total_supply":50001802941.77713,"platform":null,"cmc_rank":19,"last_updated":"2021-08-03T13:32:46.000Z","quote":{"USD":{"price":0.27220802340662,"volume_24h":500682909.81528753,"percent_change_1h":1.55491393,"percent_change_24h":-2.53998808,"percent_change_7d":1.3960239,"percent_change_30d":1.08730799,"percent_change_60d":-29.35467417,"percent_change_90d":-52.96825078,"market_cap":6370832434.905395,"last_updated":"2021-08-03T13:32:46.000Z"}}},{"id":4943,"name":"Dai","symbol":"DAI","slug":"multi-collateral-dai","num_market_pairs":497,"date_added":"2019-11-22T00:00:00.000Z","tags":["defi","stablecoin","ethereum","binance-smart-chain","avalanche-ecosystem","polygon-ecosystem"],"max_supply":null,"circulating_supply":5680559857.293418,"total_supply":5680560346.132563,"platform":{"id":1027,"name":"Ethereum","symbol":"ETH","slug":"ethereum","token_address":"0x6b175474e89094c44da98b954eedeac495271d0f"},"cmc_rank":20,"last_updated":"2021-08-03T13:32:18.000Z","quote":{"USD":{"price":1.00101717473713,"volume_24h":428114260.03937346,"percent_change_1h":0.01139857,"percent_change_24h":-0.06874967,"percent_change_7d":-0.01886486,"percent_change_30d":0.04470904,"percent_change_60d":-0.0711125,"percent_change_90d":0.08237835,"market_cap":5686337979.273011,"last_updated":"2021-08-03T13:32:18.000Z"}}}]}
     this.responseData = response.data;


  }

  //API call to get the list of cryptoCurrency
  getListOfCrypto(){
    this.http.setDataSerializer("json");
    this.ionLoaderService.loader();
    this.showTryAgain = false;
    this.platform.ready().then(() => { 
    this.http.get(this.cryptoListUrl, {}, this.headers)
       .then(res => {
          this.ionLoaderService.dismissLoader();
          if(res.status == 200){
            let response : Post = JSON.parse(res.data);
            if(response.status.error_code == 0){
              this.responseData = response.data;
            }else if(response.status.error_code == 400){ //Bad Request condition
              this.showTryAgain = true;
              this.ionLoaderService.showError("Bad request. Try Again");
            }else if(response.status.error_code == 1002){ //Unauthorized
              this.showTryAgain = true;
              this.ionLoaderService.showError("Unauthorized user");
            }else if(response.status.error_code == 1006){ //Forbidden
              this.showTryAgain = true;
              this.ionLoaderService.showError("User is Forbidden");
            }else if(response.status.error_code == 1008){ //Too Many request
              this.showTryAgain = true;
              this.ionLoaderService.showError("Too Many Request. Try Again");
            }else if(response.status.error_code == 500){ //Internal Server Error
              this.showTryAgain = true;
              this.ionLoaderService.showError("Internal Server Error");
            }
          }else{
            this.showTryAgain = true;
            this.ionLoaderService.showError("Unable to process your request");
          }
       })
       .catch(error => {
         this.ionLoaderService.dismissLoader();
         this.showTryAgain = true;
         console.log("--------",error);
       });
      });
  }

  // Navigate to Crypto Details Page of select crypto currency and share the data with router params
  goToDetails(cryptDetails){
    console.log(cryptDetails);
    let ObjToSend : NavigationExtras = cryptDetails;
    this.router.navigate(['/cryto-details'], { 
      state: ObjToSend 
    });
  }

}
